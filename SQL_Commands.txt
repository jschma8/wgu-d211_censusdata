download file 
extract all
destination location needs to be "C:\Users\Public"

Open pgAdmin4
In Browser, Open Server > Databases > Churn
right click on Churn and open Query Tool
In query editor copy and paste everything below:

-- SQL Commands: -- 
-- create the table census_raw -- 
create table census_raw
(Geographic_Area_Name varchar,
us_State varchar,
"2017_NAICS_code" varchar,
NAICS2017_LABEL varchar,
SEX_LABEL varchar,
ETH_GROUP_LABEL varchar,
RACE_GROUP_LABEL varchar,
VET_GROUP_LABEL varchar,
number_of_employer_firms varchar,
number_of_employees varchar,
"Annual_payroll_$1,000" varchar
);

-- import data --
COPY census_raw
FROM 'C:\Users\Public\wgu-d211_censusdata-main\ABSCS2020.AB2000CSA01-Data.csv'
DELIMITER ','
CSV HEADER;

-- clean up data --
--- drop rows ---
DELETE from census_raw where "2017_NAICS_code" <> '0';
DELETE from census_raw where eth_group_label <> 'Total';
DELETE from census_raw where race_group_label <> 'Total';
DELETE from census_raw where vet_group_label <> 'Total';
DELETE FROM census_raw where us_State = '#N/A';
DELETE FROM census_raw where us_State is NULL;

--rename problem columns
ALTER TABLE 
	census_raw
RENAME COLUMN
	"Annual_payroll_$1,000"
TO
	payroll;

-- create cleaned table --
CREATE TABLE census
(us_State varchar,
firms varchar,
total_employees varchar,
total_payroll varchar,
female_employees varchar,
female_payroll varchar,
male_employees varchar,
male_payroll varchar
);

-- add data into correct columns
INSERT INTO census
SELECT DISTINCT us_state FROM census_raw;

UPDATE
	census AS cn
SET 
	firms = cr.number_of_employer_firms,
	total_employees = cr.number_of_employees,
	total_payroll = cr.payroll
FROM
	census_raw AS cr
WHERE
	 cr.us_State = cn.us_State
AND
	cr.sex_label = 'Total'; 

UPDATE
	census AS cn
SET 
	female_employees = cr.number_of_employees,
	female_payroll = cr.payroll
FROM
	census_raw AS cr
WHERE
	 cr.us_State = cn.us_State
AND
	cr.sex_label = 'Female'; 

UPDATE
	census AS cn
SET 
	male_employees = cr.number_of_employees,
	male_payroll = cr.payroll
FROM
	census_raw AS cr
WHERE
	 cr.us_State = cn.us_State
AND
	cr.sex_label = 'Male'; 

-- drop extra census table
DROP TABLE census_raw;

